<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced SIP Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; --card: #ffffff; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); padding: 20px; }
        .container { max-width: 1000px; margin: auto; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: var(--card); padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .full-width { grid-column: 1 / -1; }
        h2 { margin-top: 0; color: #1e293b; font-size: 1.25rem; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 5px; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
        .stats { margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px; }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.95rem; }
        .val { font-weight: bold; color: var(--primary); }
        
        /* Table Styling */
        .table-wrapper { max-height: 400px; overflow-y: auto; margin-top: 10px; border: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th { position: sticky; top: 0; background: var(--primary); color: white; padding: 12px; }
        td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; }
        tr:nth-child(even) { background: #f8fafc; }

        @media (max-width: 768px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h2>Investment Details</h2>
        <div class="input-group">
            <label>Monthly Investment (₹)</label>
            <input type="number" id="monthlyAmount" value="5000" oninput="calculate()">
        </div>
        <div class="input-group">
            <label>Expected Return Rate (% p.a)</label>
            <input type="number" id="returnRate" value="12" oninput="calculate()">
        </div>
        <div class="input-group">
            <label>Duration (Years - Max 50)</label>
            <input type="number" id="years" value="10" max="50" oninput="calculate()">
        </div>

        <div class="stats">
            <div class="stat-row"><span>Invested Amount:</span> <span id="resInvested" class="val">0</span></div>
            <div class="stat-row"><span>Wealth Gained:</span> <span id="resGains" class="val">0</span></div>
            <div class="stat-row"><span>Total Value:</span> <span id="resTotal" class="val">0</span></div>
        </div>
    </div>

    <div class="card">
        <h2>Wealth Breakup</h2>
        <canvas id="sipChart"></canvas>
    </div>

    <div class="card full-width">
        <h2>Yearly Growth Table</h2>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Year</th>
                        <th>Invested Amount</th>
                        <th>Estimated Returns</th>
                        <th>Total Value</th>
                    </tr>
                </thead>
                <tbody id="growthTableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let myChart = null;

    function calculate() {
        const P = parseFloat(document.getElementById('monthlyAmount').value) || 0;
        const annualRate = parseFloat(document.getElementById('returnRate').value) || 0;
        let years = parseFloat(document.getElementById('years').value) || 0;
        
        if(years > 50) years = 50; // Cap at 50 years

        const i = annualRate / 12 / 100;
        const totalMonths = years * 12;

        const totalValue = P * ((Math.pow(1 + i, totalMonths) - 1) / i) * (1 + i);
        const totalInvested = P * totalMonths;
        const totalGains = totalValue - totalInvested;

        // Update Summary
        document.getElementById('resInvested').innerText = "₹" + Math.round(totalInvested).toLocaleString('en-IN');
        document.getElementById('resGains').innerText = "₹" + Math.round(totalGains).toLocaleString('en-IN');
        document.getElementById('resTotal').innerText = "₹" + Math.round(totalValue).toLocaleString('en-IN');

        updateChart(totalInvested, totalGains);
        updateTable(P, i, years);
    }

    function updateChart(invested, gains) {
        const ctx = document.getElementById('sipChart').getContext('2d');
        if (myChart) myChart.destroy();
        
        myChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Invested', 'Gains'],
                datasets: [{
                    data: [invested, gains],
                    backgroundColor: ['#cbd5e1', '#2563eb'],
                    borderWidth: 0
                }]
            },
            options: { plugins: { legend: { position: 'bottom' } } }
        });
    }

    function updateTable(P, i, totalYears) {
        const tbody = document.getElementById('growthTableBody');
        tbody.innerHTML = "";
        
        for (let y = 1; y <= totalYears; y++) {
            let months = y * 12;
            let yearlyInvested = P * months;
            let yearlyTotal = P * ((Math.pow(1 + i, months) - 1) / i) * (1 + i);
            let yearlyGains = yearlyTotal - yearlyInvested;

            let row = `<tr>
                <td>${y}</td>
                <td>₹${Math.round(yearlyInvested).toLocaleString('en-IN')}</td>
                <td>₹${Math.round(yearlyGains).toLocaleString('en-IN')}</td>
                <td>₹${Math.round(yearlyTotal).toLocaleString('en-IN')}</td>
            </tr>`;
            tbody.innerHTML += row;
        }
    }

    // Initialize
    calculate();
</script>

</body>
</html>